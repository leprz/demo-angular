@if (todoDetailsResult$ | async; as details) {
  <ui-loaded-content
    [content]="details">
    @if (details.value?.content; as todo) {
      <article
        class="todo-details" [ngClass]="{'todo-details__complete': todo.isComplete}">
        <div class="todo-details__header">
          <span class="todo-details__status">
            {{ todo.isComplete ? 'Done' : 'Todo' }}
          </span>
          <feature-permissions
            class="todo-details__actions"
            #featurePermissionsComponent>
            @if (featurePermissionsComponent.permissions$ | async; as permissions) {
              <feature-todo-resolution
                [params]="todo"
                [permissions]="permissions.value ?? []"
                #featureResolution
              >
                 <span
                   class="todo-details__action todo-details__action--resolution">
                  @if (featureResolution.resolutionResult$ | async; as resolutionResult) {
                    @if (resolutionResult.data | hasError) {
                      <span [title]="resolutionResult.data.error.message" class="icon-exclamation"></span>
                    }
                    <button
                      type="button"
                      (click)="featureResolution.updateResolution(todo, !todo.isComplete)"
                    >
                      {{ todo.isComplete ? 'Unresolve' : 'Resolve' }}
                    </button>
                  }
                </span>
              </feature-todo-resolution>

              <feature-todo-delete #featureDelete [params]="todo" [permissions]="permissions.value ?? []">
                @if (featureDelete.deleteResult$ | async; as deleteResult) {
                  @if (deleteResult.data | hasError) {
                    <span [title]="deleteResult.data.error.message" class="icon-exclamation"></span>
                  }
                  <span
                    class="todo-details__action todo-details__action--delete">
                   <button
                     [disabled]="featureDelete.isDisabled()"
                     (click)="featureDelete.delete(todo)"
                   >Delete</button>
                </span>
                }
              </feature-todo-delete>
            }
          </feature-permissions>
        </div>
        <form [formGroup]="todoFormGroup" class="todo-details__body">
          <span>#{{ todo.id }}</span>
          <editable class="todo-details__field-name"
                    (save)="onEditableSave()"
                    (cancel)="onEditableCancel()"
                    (modeChange)="onEditableModeChange()"
          >
            <ng-template viewMode>
              <span>{{ todoFormGroup.get(TodoEditForm.FIELD_TITLE)?.value }}</span>
            </ng-template>
            <ng-template editMode>
              <input type="text" editableOnEnter editableFocusable editableOnEscape
                     [formControlName]="TodoEditForm.FIELD_TITLE">
              <ui-form-errors
                class="form-control__errors"
                [control]="todoFormGroup.controls[TodoEditForm.FIELD_TITLE]"
              ></ui-form-errors>
            </ng-template>
          </editable>
        </form>
      </article>
    }
  </ui-loaded-content>
}

